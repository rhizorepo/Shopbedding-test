<?php
class BorderJump_BorderShip_Model_Currency extends Mage_Directory_Model_Currency
{
    /**
     * Convert price to currency format
     *
     * @param   double $price
     * @param   string $toCurrency
     * @return  double
     */
    public function convert($price, $toCurrency=null)
    {
        if (is_null($toCurrency)) {
            return $price;
        }
        elseif ($rate = $this->getRate($toCurrency)) {
	    // If an address has already been set, see if it's for one of the countries defined in bordership config
            $bordership = Mage::getModel('bordership/carrier_bordership');

            if ($bordership->getConfigData('sallowspecific') == 1) {


try {
// 	$country = Mage::getSingleton('checkout/session')->getQuote()->getShippingAddress()->getCountry();
	$this->getRate("UUU");
} catch (Exception $e) {
    echo 'Caught exception: ',  $e->getMessage(), "\n";
    die("fail");
}

	die("nope");
// 		$country = Mage::getSingleton('checkout/session')->getQuote()->getShippingAddress()->getCountry(); 
//$country="US";
                $availableCountries = explode(',', $bordership->getConfigData('specificcountry'));

                if (!in_array($country, $availableCountries)) {
            // Country is blank or isn't one defined in bordership config
//Mage::log("country $country not in array");
                    return $price*$rate;
                } else {
		    return ceil($price*$rate*100)/100;
		}
            }   
	    // Country matches bordership config so use ceiling rounding method
//Mage::log("country $country in array");
        } else {
	    return $price;
	}
    }
}
